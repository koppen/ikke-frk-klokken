<!DOCTYPE html>
<html lang="da-DK">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frk. Klokken'ish</title>

    <style>
      body {
        background: #000000;
        color: #dddddd;
        font-family: 'Century Gothic', CenturyGothic, AppleGothic, sans-serif;
      }

      .subtitles {
        bottom: 3rem;
        font-size: 2rem;
        font-weight: bold;
        position: absolute;
        text-align: center;
        width: 100%;
      }

      .controls {
        position: absolute;
        right: 2em;
        top: 1em;
      }
      .controls button {
        appearance: none;
        color: #dddddd;
        background: transparent;
        border: 0;
        transition: all 0.2s;
        width: 3em;
      }
      body[data-subtitles=false] button.toggleSubtitles {
        opacity: 0.7;
      }
      body[data-subtitles=false] .subtitles {
        opacity: 0
      }
      body[data-subtitles=true] button.toggleSubtitles {
        opacity: 1;
      }
      body[data-subtitles=true] .subtitles {
        opacity: 1
      }
    </style>

    <script type="module">
      import { Application, Controller } from "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js"
      window.Stimulus = Application.start()

      Stimulus.register("klokken", class extends Controller {
        static targets = [ "subtitles" ]

        connect() {
          this.subtitles = false

          setInterval(this.speakTheTime.bind(this), 10000)
          this.speakTheTime()
          this.updateUI()
        }

        showSubtitles(message) {
          if (this.subtitles && this.subtitlesTarget) {
            this.subtitlesTarget.innerHTML = message
          }
        }

        speak(message) {
          let utterance = new SpeechSynthesisUtterance(message);
          utterance.lang = "da-DK"
          utterance.rate = 0.8
          speechSynthesis.speak(utterance);
        }

        speakTheTime() {
          let currentDate = new Date()
          let hours = currentDate.getHours()
          let minutes = currentDate.getMinutes()
          let seconds = currentDate.getSeconds()

          let secondsRounded = Math.floor(seconds / 10) * 10

          this.speak(hours)
          this.speak(minutes)
          this.speak(`og ${secondsRounded}`)
          this.speak("dut.")
          this.showSubtitles(`${hours} ${minutes} og ${secondsRounded}. Dut.`);
        }

        toggleSubtitles() {
          this.subtitles = !this.subtitles
          this.updateUI()
        }

        updateUI() {
          this.element.dataset.subtitles = this.subtitles
        }
      })
    </script>
  </head>
  <body data-controller="klokken">
    <button data-action="klokken#speakTheTime">Speak!</button>

    <div class="controls">
      <button class="toggleSubtitles" data-action="klokken#toggleSubtitles">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"></path></svg>
      </button>
    </div>

    <div class="subtitles" data-klokken-target="subtitles"></div>
  </body>
</html>
