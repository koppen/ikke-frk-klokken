<!DOCTYPE html>
<html lang="da-DK">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frk. Klokken'ish</title>

    <style>
      body {
        background: #000000;
        color: #dddddd;
      }
    </style>

    <script type="module">
      import { Application, Controller } from "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js"
      window.Stimulus = Application.start()

      Stimulus.register("klokken", class extends Controller {
        static targets = [ "subtitles" ]

        connect() {
          this.subtitles = true

          setInterval(this.speakTheTime.bind(this), 10000)
          this.speakTheTime()

          document.querySelector("button").addEventListener("click", this.speakTheTime.bind(this))
        }

        showSubtitles(message) {
          if (this.subtitles && this.subtitlesTarget) {
            this.subtitlesTarget.innerHTML = message
          }
        }

        speak(message) {
          let utterance = new SpeechSynthesisUtterance(message);
          utterance.lang = "da-DK"
          utterance.rate = 0.8
          speechSynthesis.speak(utterance);
        }

        speakTheTime() {
          let currentDate = new Date()
          let hours = currentDate.getHours()
          let minutes = currentDate.getMinutes()
          let seconds = currentDate.getSeconds()

          let secondsRounded = Math.floor(seconds / 10) * 10

          this.speak(hours)
          this.speak(minutes)
          this.speak(`og ${secondsRounded}`)
          this.speak("dut.")
          this.showSubtitles(`${hours} ${minutes} og ${secondsRounded}. Dut.`);
        }
      })
    </script>
  </head>
  <body data-controller="klokken">
    <button>Speak!</button>

    <div class="subtitles" data-klokken-target="subtitles"></div>
  </body>
</html>
